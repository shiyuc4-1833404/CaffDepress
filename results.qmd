```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```
# Results
```{r,echo=FALSE}
library(dplyr)
library(haven)
library(ggplot2)
data <- read_xpt("DR1IFF_J.XPT")
depress <- read_xpt("DPQ_J.XPT")
data2 <- dplyr::select(data, SEQN, DR1ICAFF)
data2 <- data2 |>
  group_by(SEQN) |>
  dplyr::summarise(CaffConsump = sum(DR1ICAFF))
merged_data <- merge(data2, depress, by = "SEQN", all = TRUE)
columns <- colnames(merged_data)[1:11]
merged_data <- dplyr::select(merged_data, columns)
merged_data <- na.omit(merged_data)
for (i in columns) {
  merged_data[[i]][merged_data[[i]] == 7] <- 0
  merged_data[[i]][merged_data[[i]] == 9] <- 0
}
merged_data$depressScore <- rowSums(merged_data[, 3:ncol(merged_data)])
merged_data$depressLevel <- merged_data$depressScore
merged_data <- merged_data |>
  mutate(depressLevel = case_when(
    depressLevel >= 0 & depressLevel <= 5 ~ "remission",
    depressLevel > 5 & depressLevel <= 10 ~ "mild",
    depressLevel > 10 & depressLevel <= 15 ~ "moderate",
    depressLevel > 15 & depressLevel <= 20 ~ "moderately severe",
    depressLevel > 20 ~ "severe",
    TRUE ~ as.character(depressLevel)))
ggplot(merged_data, aes(depressScore, CaffConsump)) +
        geom_point(size=0.8) +
  facet_wrap(~factor(depressLevel, levels=c('remission', 'mild', 'moderate',
                                              'moderately severe', 'severe')),
             scales="free_y")+
  # facet_wrap(~depressLevel, scales="free_y") +
  xlab("Depression Score") +
  ylab("Caffeine Intake") +
  ggtitle("Scatterplot of Caffeine Intake vs. Depression Score")
```
