```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```
# Results
```{r,echo=FALSE}
# Deal with Coffeine and Depression dataset
library(dplyr)
library(haven)
library(ggplot2)
data <- read_xpt("DR1IFF_J.XPT")
depress <- read_xpt("DPQ_J.XPT")
data2 <- dplyr::select(data, SEQN, DR1ICAFF)
data2 <- data2 |>
  group_by(SEQN) |>
  dplyr::summarise(CaffConsump = sum(DR1ICAFF))
merged_data <- merge(data2, depress, by = "SEQN", all = TRUE)
columns <- colnames(merged_data)[1:11]
merged_data <- dplyr::select(merged_data, columns)
merged_data <- na.omit(merged_data)
for (i in columns) {
  merged_data[[i]][merged_data[[i]] == 7] <- 0
  merged_data[[i]][merged_data[[i]] == 9] <- 0
}
merged_data$depressScore <- rowSums(merged_data[, 3:ncol(merged_data)])
merged_data$depressLevel <- merged_data$depressScore
merged_data <- merged_data |>
  mutate(depressLevel = case_when(
    depressLevel >= 0 & depressLevel <= 5 ~ "remission",
    depressLevel > 5 & depressLevel <= 10 ~ "mild",
    depressLevel > 10 & depressLevel <= 15 ~ "moderate",
    depressLevel > 15 & depressLevel <= 20 ~ "moderately severe",
    depressLevel > 20 ~ "severe",
    TRUE ~ as.character(depressLevel)))
```

```{r,echo=FALSE}
# Deal with Demo dataset
info <- read_xpt("DEMO_J.XPT")
oldname <- c("DMDHRGND", "DMDHRAGZ", "RIDRETH3", "INDFMIN2", "DMDHRMAZ")
newname <- c("Gender", "Age", "Race", "Income", "maritalStatus")
info <- dplyr::select(info, SEQN, DMDHRGND, DMDHRAGZ, RIDRETH3,
                      INDFMIN2, DMDHRMAZ)
merged_info <- merge(merged_data, info, by = "SEQN", all = TRUE)
merged_info <- na.omit(merged_info)
for (i in 1:5) {
  names(merged_info)[names(merged_info) == oldname[i]] <- newname[i]
}
merged_info <- merged_info |>
  mutate(Gender = case_when(
    Gender == 1 ~ "Male",
    Gender == 2 ~ "Female",
    TRUE ~ as.character(Gender)))
merged_info <- merged_info |>
  mutate(Age = case_when(
    Age == 1 ~ "<20 years",
    Age == 2 ~ "20-39 years",
    Age == 3 ~ "40-59 years",
    Age == 4 ~ "60+ years",
    TRUE ~ as.character(Age)))
merged_info <- merged_info |>
  mutate(Race = case_when(
    Race == 1 | Race == 2 ~ "Hispanic",
    Race == 3 ~ "White",
    Race == 4 ~ "Black",
    Race == 6 ~ "Asian",
    Race == 7 ~ "Other",
    TRUE ~ as.character(Race)))

merged_info <- merged_info |>
  mutate(maritalStatus = case_when(
    maritalStatus == 1 ~ "Married",
    maritalStatus == 2 ~ "Widowed",
    maritalStatus == 3 ~ "Divorced",
    TRUE ~ as.character(maritalStatus)))

code <- c(1:15,77,99)
var <- c("$<$20,000","$<$20,000","$<$20,000",
         "<$20,000","$20,000-$24,999","$25,000-$34,999",
         "$35,000-$44,999","$45,000-$54,999","$55,000-$64,999",
         "$65,000-$74,999",">$20,000","<$20,000","$75,000-$99,999",
         ">$100,000","Refused","Don't know")
for (i in 1:17) {
  merged_info <- merged_info |>
    mutate(Income = case_when(
      Income == code[i] ~ var[i],
      TRUE ~ as.character(Income)))
}
```

## Plot1
```{r}
# Plot1
ggplot(merged_info, aes(depressScore, CaffConsump)) +
        geom_point(size=0.8) +
  facet_wrap(~factor(depressLevel, levels=c('remission', 'mild', 'moderate',
                                            'moderately severe', 'severe')),
             scales="free_y")+
  # facet_wrap(~depressLevel, scales="free_y") +
  xlab("Depression Score") +
  ylab("Caffeine Intake") +
  ggtitle("Scatterplot of Caffeine Intake vs. Depression Score")
```
## Plot2
```{r}

```

