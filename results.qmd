```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
```
# Results
```{r,echo=FALSE}
# Deal with Coffeine and Depression dataset
library(ggridges)
library(dplyr)
library(haven)
library(ggplot2)
data <- read_xpt("DR1IFF_J.XPT")
depress <- read_xpt("DPQ_J.XPT")
data2 <- dplyr::select(data, SEQN, DR1ICAFF)
data2 <- data2 |>
  group_by(SEQN) |>
  dplyr::summarise(CaffConsump = sum(DR1ICAFF))
merged_data <- merge(data2, depress, by = "SEQN", all = TRUE)
columns <- colnames(merged_data)[1:11]
merged_data <- dplyr::select(merged_data, columns)
merged_data <- na.omit(merged_data)
for (i in columns) {
  merged_data[[i]][merged_data[[i]] == 7] <- 0
  merged_data[[i]][merged_data[[i]] == 9] <- 0
}
merged_data$depressScore <- rowSums(merged_data[, 3:ncol(merged_data)])
merged_data$depressLevel <- merged_data$depressScore
merged_data <- merged_data |>
  mutate(depressLevel = case_when(
    depressLevel >= 0 & depressLevel <= 5 ~ "remission",
    depressLevel > 5 & depressLevel <= 10 ~ "mild",
    depressLevel > 10 & depressLevel <= 15 ~ "moderate",
    depressLevel > 15 & depressLevel <= 20 ~ "moderately severe",
    depressLevel > 20 ~ "severe",
    TRUE ~ as.character(depressLevel)))
```

```{r,echo=FALSE}
# Deal with Demo dataset
info <- read_xpt("DEMO_J.XPT")
oldname <- c("DMDHRGND", "DMDHRAGZ", "RIDRETH3", "INDFMIN2", "DMDHRMAZ")
newname <- c("Gender", "Age", "Race", "Income", "maritalStatus")
info <- dplyr::select(info, SEQN, DMDHRGND, DMDHRAGZ, RIDRETH3,
                      INDFMIN2, DMDHRMAZ)
merged_info <- merge(merged_data, info, by = "SEQN", all = TRUE)
merged_info <- na.omit(merged_info)
for (i in 1:5) {
  names(merged_info)[names(merged_info) == oldname[i]] <- newname[i]
}
merged_info <- merged_info |>
  mutate(Gender = case_when(
    Gender == 1 ~ "Male",
    Gender == 2 ~ "Female",
    TRUE ~ as.character(Gender)))

set.seed(123)
max <- c(20,39,59,70)
min <- c(15,20,40,60)
code <-c(1:4)
merged_info <- mutate(merged_info, Age = sapply(Age, function(x) {
  if (x %in% code) {
    i <- which(code == x)
    if (!is.na(min[i]) && !is.na(max[i])) {
      return(sample(min[i]:max[i], 1))
    }
  }
}))

merged_info <- merged_info |>
  mutate(Race = case_when(
    Race == 1 | Race == 2 ~ "Hispanic",
    Race == 3 ~ "White",
    Race == 4 ~ "Black",
    Race == 6 ~ "Asian",
    Race == 7 ~ "Other",
    TRUE ~ as.character(Race)))

merged_info <- merged_info |>
  mutate(maritalStatus = case_when(
    maritalStatus == 1 ~ "Married",
    maritalStatus == 2 ~ "Widowed",
    maritalStatus == 3 ~ "Divorced",
    TRUE ~ as.character(maritalStatus)))
```

```{r}
code <- c(1:10,12,13,14,15)
code2 <-c(77,99)
max <- c(4999,9999,14999,19999,24999,34999,44999,54999,64999,74999,0,110000,20000,99999,110000)
min <- c(1000,5000,10000,15000,20000,25000,35000,45000,55000,65000,0,20000,1000,75000,10000)
var <- c("<$20,000","<$20,000","<$20,000",
         "<$20,000","$20,000-$24,999","$25,000-$34,999",
         "$35,000-$44,999","$45,000-$54,999","$55,000-$64,999",
         "$65,000-$74,999",">$20,000","<$20,000","$75,000-$99,999",
         ">$100,000","Refused","Don't know")

set.seed(123)  # Set seed for reproducibility
merged_info <- mutate(merged_info, Income = sapply(Income, function(x) {
  if (x %in% code) {
    i <- which(code == x)
    if (!is.na(min[i]) && !is.na(max[i])) {
      return(sample(min[i]:max[i], 1))
    }
  }
  if (x %in% code2){
    return(NA)
  }
}))
merged_info$Income <- as.numeric(as.character(merged_info$Income))
```

## Plot1
```{r}
# Plot1
ggplot(merged_info, aes(depressScore, CaffConsump)) +
        geom_point(size=0.8) +
  facet_wrap(~factor(depressLevel, levels=c('remission', 'mild', 'moderate',
                                            'moderately severe', 'severe')),
             scales="free_y")+
  # facet_wrap(~depressLevel, scales="free_y") +
  xlab("Depression Score") +
  ylab("Caffeine Intake") +
  ggtitle("Scatterplot of Caffeine Intake vs. Depression Score")
```
## Plot2
```{r}
update <- merged_info |>
  na.omit(merged_info$Income)
ggplot(update, aes(x=Income))+
  geom_histogram(aes(y=after_stat(density)),binwidth = 3000, fill = "blue", color = "black", alpha = 0.7) +
  geom_density(lwd=1.25)+
  labs(title = "Income Distribution", x = "Income", y = "Frequency") +
  theme_minimal()
```
## Plot3
```{r}
ggplot(merged_info, aes(x=Income, y=depressLevel)) + 
  geom_density_ridges(scale=0.75)+
geom_boxplot(width=0.3)+
  labs(title="Income horizontal boxplots and ridgeline plots vs. Depression Level",x="Income", y = "Depression Level")
```
## Plot4
```{r}
ggplot(merged_info) +
  geom_hex(aes(x = CaffConsump, y = depressScore), bins = 10) +
  labs(
    title = "Square Heatmap of Bin Counts",
    x = "Caffeine Consumption",
    y = "depressScore")
```
## Plot5
```{r}
library(forcats)
ggplot(merged_info, aes(x=fct_infreq(Race), fill = Gender)) + 
  geom_bar() +
  ylab("Count") +
  xlab("Race") +
  ggtitle("Frequency of Race by Gender")
```
## Plot6
```{r}
library(vcd)
library(vcdExtra)
library(RColorBrewer)
library(MASS)
group <- quantile(merged_info$CaffConsump)
merged_info$ConsumpLevel <- cut(merged_info$CaffConsump,
                                breaks=c(group[1]-1, group[2], group[3], group[4], group[5]),
                                right=TRUE,
                                left=FALSE,
                                labels = c("Low", "Mild", "Moderate",
                                          "High"))
merged_info <- transform(merged_info, depressLevel = factor(depressLevel, 
                                                            levels = c("remission", "mild", 
                                                                       "moderate", "moderately severe",
                                                                       "severe")))
mosaic(~ConsumpLevel + depressLevel,
       labeling=vcd::labeling_border(rot_labels = c(0, 0),
                                  labeling_args = list(cex = 1)),
       main="Mosaic Plot of Coffeine Consumption and Depression Level",
       data=merged_info, direction=c("v","h"),
       spacing = spacing_dimequal(c(.4, 0)),
       highlighting = "depressLevel",
       highlighting_fill = c("#EFF3FF", "#BDD7E7", "#6BAED6", "#3182BD", "#08519C"))
```
## Plot7
```{r}
library("ggpubr")
high <- ggplot(data=merged_info,aes(x = CaffConsump)) +
  geom_histogram() +
  xlim(0, 500) +
  ylim(0,400) +
  ggtitle("Histogram of Caffine Consumption Lower Part") +
  xlab("Caffine Consumption")
low <- ggplot(data=merged_info,aes(x = CaffConsump)) +
  geom_histogram() +
  xlim(500, max(merged_info$CaffConsump)) +
  ggtitle("Histogram of Caffine Consumption Higher Part") +
  xlab("Caffine Consumption")
ggarrange(high, low, ncol = 1, nrow = 2)
```
## Plot8
```{r}
library(GGally)
ggparcoord(data = merged_info, columns = c(2,12,15),alphaLines = 0.01) + ggtitle('Nutrients Parallel Coordinates Plot')
```
